!function () {
    function lerp(a, b, n) {
        return (1 - n) * a + n * b;
    }

    var cursor = document.getElementById("cursor"),
        mouse = { pre: null, now: null },
        elements = document.getElementsByTagName("*"),
        pointerElements = [];

    // Wait for the document to load
    window.addEventListener("load", function () {
        // Collect all elements with "pointer" cursor style
        for (var i = 0; i < elements.length; i++) {
            if (window.getComputedStyle(elements[i]).cursor === "pointer") {
                pointerElements.push(elements[i].outerHTML);
            }
        }

        // Create a style element to set custom cursor globally
        var styleElement = document.createElement("style");
        styleElement.innerHTML = '* { cursor: url("data:image/svg+xml, <svg xmlns=\\"http://www.w3.org/2000/svg\\" viewBox=\\"0 0 8 8\\" width=\\"8px\\" height=\\"8px\\"><circle cx=\\"4\\" cy=\\"4\\" r=\\"4\\" opacity=\\".5\\"/></svg>") 4 4, auto !important; }';
        document.body.appendChild(styleElement);
    });

    // Event listeners for mouse interaction
    document.addEventListener("mouseover", function (event) {
        if (pointerElements.includes(event.target.outerHTML)) {
            cursor.classList.add("hover");
        }
    });

    document.addEventListener("mouseout", function (event) {
        if (pointerElements.includes(event.target.outerHTML)) {
            cursor.classList.remove("hover");
        }
    });

    document.addEventListener("mousemove", function (event) {
        if (!mouse.now) {
            cursor.style.left = event.clientX - 8 + "px";
            cursor.style.top = event.clientY - 8 + "px";
        }
        mouse.now = { x: event.clientX - 8, y: event.clientY - 8 };
        cursor.classList.add("visible");
    });

    document.addEventListener("mouseenter", function () {
        cursor.classList.add("visible");
        mouse.pre = null;
    });

    document.addEventListener("mouseleave", function () {
        cursor.classList.remove("visible");
    });

    document.addEventListener("mousedown", function () {
        cursor.classList.add("active");
    });

    document.addEventListener("mouseup", function () {
        cursor.classList.remove("active");
    });

    // Animation loop for cursor movement
    requestAnimationFrame(function animate() {
        if (mouse.pre) {
            mouse.pre = { x: lerp(mouse.pre.x, mouse.now.x, 0.15), y: lerp(mouse.pre.y, mouse.now.y, 0.15) };
            cursor.style.left = mouse.pre.x + "px";
            cursor.style.top = mouse.pre.y + "px";
        } else {
            mouse.pre = mouse.now;
        }
        requestAnimationFrame(animate);
    });
}();
